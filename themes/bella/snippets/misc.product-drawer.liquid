{% comment %}
  Render a product drawer (Choose Options)

  Usage:
  {% render 'misc.product-drawer' %}
{% endcomment %}

<button
  ui-slot="button"
  data-variant="primary"
  data-mode="filled"
  data-size="lg"
  popovertarget="product-drawer-{{ product.id }}"
>
  Choose Options
</button>
<button
  ui-slot="button"
  data-variant="primary"
  data-mode="lighter"
  data-size="lg"
  data-as-icon
  popovertarget="product-drawer-{{ product.id }}"
>
  {% render 'misc.icon', name: settings.cart_icon %}
</button>

<div class="product-drawer" ui-slot="sheet-content" id="product-drawer-{{ product.id }}" popover>
  <div ui-slot="sheet-header">
    <button
      ui-slot="button"
      data-variant="primary"
      data-mode="lighter"
      data-size="md"
      aria-label="Close"
      popovertarget="product-drawer-{{ product.id }}"
    >
      {% render 'misc.icon', name: 'hgi-cancel-01' %}
    </button>
  </div>
  <ui-product ui-slot="sheet-body" product-id="{{ product.id }}">
    <ui-carousel class="media-area" data-layout="carousel">
      <ul class="images" ui-carousel="wrapper" ui-slot="carousel" aria-orientation="vertical">
        {% if product.images.size %}
          {% for image in product.images %}
            <li class="image" ui-carousel="item" ui-slot="carousel-item">
              <img
                src="{{ image }}"
                alt="{{ product.name }}"
                height="100%"
                width="100%"
                loading="lazy"
              >
            </li>
          {% endfor %}
        {% else %}
          <li class="image" ui-carousel="item" ui-slot="carousel-item">
            {% render 'misc.image-fallback', icon_size: 60 %}
          </li>
        {% endif %}
      </ul>
      {% if product.images.size > 1 %}
        <div class="markers" ui-slot="carousel" aria-orientation="vertical" data-align="center">
          {% for marker in product.images %}
            <button
              ui-carousel="marker"
              aria-label="Slide {{ forloop.index }}"
              {% if forloop.first %}
                aria-selected="true"
              {% endif %}
            ></button>
          {% endfor %}
        </div>
      {% endif %}
    </ui-carousel>
    <div class="content-area">
      <h1 ui-block="title">{{ product.name }}</h1>
      <div ui-block="rating">
        <div ui-slot="rating-review" data-variant="star">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path
              d="M11.9961 1.25C13.0454 1.25 13.8719 2.04253 14.3995 3.11191L16.1616 6.66516C16.215 6.77513 16.3417 6.92998 16.5321 7.07164C16.7223 7.21315 16.9086 7.29121 17.0311 7.3118L20.2207 7.84613C21.3729 8.03973 22.3386 8.60449 22.6521 9.5879C22.9653 10.5705 22.5064 11.5916 21.6778 12.4216L21.677 12.4225L19.1991 14.9209C19.1009 15.0199 18.9909 15.2064 18.9219 15.4494C18.8534 15.6908 18.8473 15.9107 18.8784 16.0527L18.8788 16.0547L19.5877 19.1454C19.8818 20.4317 19.7843 21.7073 18.8771 22.3742C17.9667 23.0433 16.7227 22.7467 15.5925 22.0736L12.6026 20.289C12.477 20.214 12.2614 20.1532 12.0011 20.1532C11.7427 20.1532 11.5226 20.2132 11.3888 20.291L11.3869 20.2921L8.40288 22.0732C7.27405 22.7487 6.03154 23.04 5.12111 22.3702C4.21449 21.7032 4.11214 20.43 4.40711 19.1447L5.1159 16.0547L5.11633 16.0527C5.14741 15.9107 5.14133 15.6908 5.0728 15.4494C5.0038 15.2064 4.89379 15.0199 4.79558 14.9209L2.31585 12.4206C1.49265 11.5906 1.03521 10.5704 1.34595 9.58925C1.65759 8.60525 2.62143 8.0398 3.77433 7.84606L6.96132 7.31219L6.96233 7.31202C7.07917 7.29175 7.2627 7.21456 7.45248 7.07268C7.64261 6.93054 7.76959 6.77535 7.82312 6.66516L7.82582 6.65967L9.58562 3.11097L9.58632 3.10957C10.119 2.04108 10.948 1.25 11.9961 1.25Z"
              fill="currentColor"></path>
          </svg>
          {% for star in (1..4) %}
            <i class="hgi hgi-stroke hgi-star"></i>
          {% endfor %}
        </div>
        <span class="total">({{ product.averageRating }})</span>
      </div>
      <div ui-block="price">
        <span class="original-price" ui-product-item="price">
          {{ price | default: 0 | money }}
        </span>
        <div
          class="compare-at-price"
          ui-product-item="compare-at-price"
          {% unless compare_at_price %}
            hidden
          {% endunless %}
        >
          {{ compare_at_price | default: 0 | money }}
        </div>
      </div>
      {% render 'const.inventory-status', count: default_variant.inventory %}
      {% if product.options.size > 0 %}
        {% render 'core.variants' %}
      {% endif %}
      <div ui-block="controller">
        {% render 'core.quantity', size: 'md' %}
        {% render 'core.shop-button', mode: 'lighter' %}
        {% render 'core.express-checkout', style: 'open-drawer' %}
      </div>
    </div>
  </ui-product>
  <div ui-slot="sheet-footer">
    <a href="/products/{{ product.slug }}" ui-slot="button" data-variant="primary" data-mode="ghost" data-size="lg">
      View Full Details {% render 'misc.icon', name: 'hgi-arrow-right-01' %}
    </a>
  </div>
</div>

{% if product and product.options.size %}
  {% javascript %}
    if (!window.productsVariants["{{ product.id }}"]) {
      window.productsVariants["{{ product.id }}"] = JSON.parse({{ product.variants | json }});
    }
  {% endjavascript %}
{% endif %}
